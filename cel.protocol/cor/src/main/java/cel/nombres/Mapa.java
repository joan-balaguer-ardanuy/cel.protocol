package cel.nombres;

import cel.Nombre;
import cel.arca.Lleó;
import cel.arca.Ramat;

/**
 * <tt>
 * <center>
 * <h2>Pecat i renovació de l'aliança (32-34)</h2>
 * <h3>El vedell d'or</h3>
 * <big>32</big>
 * <sup>1</sup> El poble, veient que Moisès trigava a baixar de la muntanya, es va aplegar al voltant d'Aaron i li digué:<br/>
 * --Fes-nos uns déus que vagin davant nostre, perquè d'aquest Moisès que ens ha tret del país d'Egipte no sabem què se n'ha fet.<br/>
 * <sup>2</sup> Aaron els respongué:<br/>
 * --Traieu les arracades d'or de les orelles de les vostres dones, dels vostres fills i de les vostres filles i porteu-me-les.<br/>
 * <sup>3</sup> Aleshores tot el poble es va treure les arracades d'or de les orelles i les van portar a Aaron.
 * <sup>4</sup> Ell va recollir l'or que li presentaven i en va fer un vedell de fosa, que modelà amb el cisell. Ells exclamaren:<br/>
 * --Aquests són els teus déus, Israel, que t'han tret del país d'Egipte!<br/>
 * <sup>5</sup> Aaron, veient això, va aixecar un altar davant l'estàtua i proclamà:<br/>
 * --Demà serà dia de festa en honor del Senyor!<br/>
 * <sup>6</sup> L'endemà, doncs, el poble es va llevar de bon matí, oferí holocaustos i va immolar víctimes com a sacrificis de comunió. Després es van asseure a menjar i beure, i acabat s'aixecaren per divertir-se.<br/>
 * <sup>7</sup> El Senyor digué a Moisès:<br/>
 * --Baixa de pressa, perquè el teu poble, que tu havies tret del país d'Egipte, s'ha pervertit.
 * <sup>8</sup> De seguida s'han desviat del camí que jo els indicava. S'han fabricat un vedell de fosa i es prosternen al seu davant, li ofereixen sacrificis i diuen: "Aquests són els teus déus, Israel, que t'han tret del país d'Egipte!"<br/>
 * <sup>9</sup> El Senyor va afegir:<br/>
 * --Veig com és aquest poble: sempre va a la seva.
 * <sup>10</sup> Ara, doncs, deixa'm que s'encengui contra ells la meva indignació i els extermini. Després faré de tu un gran poble.<br/>
 * <sup>11</sup> Però Moisès apaivagava el Senyor, el seu Déu, dient:<br/>
 * --Senyor, per què s'ha d'encendre el teu enuig contra el teu poble, que tu has fet sortir del país d'Egipte amb gran poder i amb mà forta?
 * <sup>12</sup> ¿Permetràs que els egipcis diguin: "Els va fer sortir amb mala intenció, per matar-los a les muntanyes i fer-los desaparèixer de la terra"? Fes-te enrere de la teva indignació, renuncia a fer mal al teu poble.
 * <sup>13</sup> Recorda't d'Abraham, d'Isaac i d'Israel, els teus servents, als quals vas jurar per tu mateix dient: "Multiplicaré la vostra descendència com les estrelles del cel, donaré tot aquest país als vostres descendents i el posseiran per sempre més."<br/>
 * <sup>14</sup> Llavors el Senyor es va desdir del mal amb què havia amenaçat el seu poble.<br/>
 * <sup>15</sup> Moisès va baixar de la muntanya amb les dues taules de l'aliança a les mans. Estaven escrites per tots dos costats.
 * <sup>16</sup> Les taules eren obra de Déu, i també era de Déu l'escriptura gravada a les taules.
 * <sup>17</sup> Quan Josuè va sentir l'aldarull del poble, digué a Moisès:<br/>
 * --Crits de guerra al campament!<br/>
 * <sup>18</sup> Ell va respondre:<br/>
 * --No són crits de victòria<br/>
 * ni són crits de derrota,<br/>
 * sinó cants de festa, el que jo sento.<br/>
 * <sup>19</sup> Quan Moisès es va acostar al campament i veié el vedell i la gent que ballava, es va indignar; llançà les taules que duia a la mà i les trencà al peu de la muntanya.
 * <sup>20</sup> Després va agafar el vedell que s'havien fabricat, el va cremar i el va moldre fins a fer-ne pols, tirà la pols dintre l'aigua i la va fer beure als israelites.<br/>
 * <sup>21</sup> Moisès va dir a Aaron:<br/>
 * --Què t'ha fet aquest poble perquè li hagis carregat un pecat tan gran?<br/>
 * <sup>22</sup> Aaron respongué:<br/>
 * --Que el meu senyor no s'indigni. Tu ja saps que aquest poble és inclinat al mal.
 * <sup>23</sup> Ells em van dir: "Fes-nos uns déus que vagin davant nostre, perquè d'aquest Moisès que ens ha tret del país d'Egipte no sabem què se n'ha fet."
 * <sup>24</sup> Llavors els vaig dir: "Qui porti or, que se'l tregui i me'l doni." Jo el vaig tirar al foc i en va sortir aquest vedell.<br/>
 * <sup>25</sup> Moisès va veure que el poble estava abandonat i que Aaron l'havia deixat a mercè dels adversaris.
 * <sup>26</sup> Llavors es va plantar a l'entrada del campament i cridà:<br/>
 * --Qui estigui amb el Senyor, que vingui cap a mi!<br/>
 * Tots els levites es van reunir al seu voltant.
 * <sup>27</sup> Ell els digué:<br/>
 * --Això diu el Senyor, Déu d'Israel: "Que cadascú prengui la seva espasa; passeu i repasseu el campament d'un cap a l'altre i mateu germans, amics i veïns."<br/>
 * <sup>28</sup> Els levites van fer el que els deia Moisès i aquell dia van caure uns tres mil homes del poble.
 * <sup>29</sup> Després Moisès digué:<br/>
 * --Avui heu rebut la consagració com a sacerdots del Senyor, matant fins i tot els vostres fills i els vostres germans: ell us dóna avui la seva benedicció.<br/>
 * <sup>30</sup> L'endemà, Moisès va dir al poble:<br/>
 * --Heu fet un gran pecat. Però ara pujaré cap al Senyor i potser obtindré el perdó del pecat que heu comès.<br/>
 * <sup>31</sup> Moisès va tornar cap al Senyor i li digué:<br/>
 * --Aquest poble ha comès un gran pecat; s'han fet uns déus d'or.
 * <sup>32</sup> Però ara vulgues perdonar el seu pecat; i si no, esborra'm del llibre que tens escrit.<br/>
 * <sup>33</sup> El Senyor respongué a Moisès:<br/>
 * --El qui ha pecat contra mi és el qui jo esborraré del meu llibre.
 * <sup>34</sup> I ara vés, condueix el poble cap al lloc que t'he indicat. El meu àngel t'anirà al davant. Però vindrà un dia que els tindré en compte el seu pecat.<br/>
 * <sup>35</sup> El Senyor va castigar el poble, perquè havien demanat a Aaron que els fes aquell vedell. <br/>
 * </center>
 * </tt>
 * 
 * @author joan
 *
 * @param <K> és la CLAU
 * @param <V> és el VALOR
 */
public final class Mapa<K,V> extends Nombre<Lleó.Cadell<K,V>> implements Lleó<K,V>, Lleó.Cadell<K,V> {

	private static final long serialVersionUID = -2252600161987761944L;

	@Override
	public String obtenirNom() {
		return "Déu";
	}
	@Override
	public K obtenirClau() {
		return obtenirEntrada().obtenirClau();
	}
	@Override
	public K establirClau(K clau) {
		return obtenirEntrada().establirClau(clau);
	}
	@Override
	public V obtenirValor() {
		return obtenirEntrada().obtenirValor();
	}
	@Override
	public V establirValor(V valor) {
		return obtenirEntrada().establirValor(valor);
	}
	
	public Mapa() {
		super();
		establirEntrada(new Entrada<>());
	}
	public Mapa(Mapa<K,V> pare) {
		super(pare);
		establirEntrada(new Entrada<>());
	}
	@Override
	public boolean establir(Cadell<K, V> e) {
		throw new IllegalStateException();
	}
	@Override
	public V establir(K clau, V valor) {
		establirClau(clau);
		establirValor(valor);
		Ramat<Lleó.Cadell<K,V>> ramat = pastor();
		for(Lleó.Cadell<K,V> cadell = ramat.següent(); ramat.téMés(); cadell = ramat.següent()) {
			if(cadell.obtenirClau() == clau) {
				return cadell.establirValor(valor);
			}
		}
		crea(Entrada.class, obtenirEntrada(), clau, valor);
		return null;
	}
	
	public static final class Entrada<K,V> extends Nombre<Lleó.Cadell<K,V>> implements Lleó.Cadell<K,V> {

		private static final long serialVersionUID = -3940712322410862005L;
		
		K clau;
		V valor;
		
		@Override
		public K obtenirClau() {
			return clau;
		}
		@Override
		public K establirClau(K clau) {
			K antiga = this.clau;
			this.clau = clau;
			return antiga;
		}
		@Override
		public V obtenirValor() {
			return valor;
		}
		@Override
		public V establirValor(V valor) {
			V antic = this.valor;
			this.valor = valor;
			return antic;
		}
		
		public Entrada() {
			super();
			establirEntrada(this);
		}
		public Entrada(Entrada<K,V> pare, K clau, V valor) {
			super(pare);
			establirEntrada(this);
			establirClau(clau);
			establirValor(valor);
		}
		@Override
		public boolean establir(Cadell<K, V> e) {
			throw new IllegalStateException();
		}
		@Override
		public String obtenirNom() {
			return "Déu";
		}
	}
}